import{g as W}from"./dp8nkxwr.js";const n=new Map,d=["192.168.120.2","192.168.121.2"];function u(){const o=window.location.hostname;let e="192.168.121.2";if(o.startsWith("192.168.120."))e="192.168.120.2";else if(o.startsWith("192.168.121."))e="192.168.121.2";else{const c=window.location.hostname;c==="localhost"||c==="127.0.0.1"?e=W(d)[0]:(e="localhost",console.warn(`âš ï¸ Cliente fuera de segmento local. Usando WS host: ${e}`))}return e}async function k(o){if(n.has(o))return console.warn(`WebSocket para "${o}" ya estÃ¡ conectado.`),n.get(o);const e=u(),a=`${window.location.protocol==="https:"?"wss":"ws"}://${e}/${o}`;console.log(`ğŸ”Œ Intentando conectar WebSocket a: ${a}`);let t=null,l=!1;try{t=new WebSocket(a),await new Promise((r,s)=>{const i=setTimeout(()=>{s(new Error("Tiempo de espera agotado en conexiÃ³n WS"))},5e3);t.onopen=()=>{l=!0,clearTimeout(i),console.log(`âœ… Conectado al WebSocket (${e})`),r()},t.onerror=S=>{clearTimeout(i),console.error(`âŒ Error en conexiÃ³n WS (${e}):`,S),s(S)}})}catch(r){console.error(`Error conectando a WebSocket (${e}):`,r),t=null}if(!l||!t)throw new Error("No se pudo establecer conexiÃ³n WebSocket con ningÃºn servidor");return t.onmessage=r=>{try{const s=JSON.parse(r.data);console.log("ğŸ“¨ Mensaje WS recibido:",s)}catch{console.warn("ğŸ“¨ Mensaje WS no es JSON vÃ¡lido:",r.data)}},t.onclose=r=>{console.log(`ğŸ”» WebSocket cerrado (${o}):`,r.reason||"sin motivo"),n.delete(o)},t.onerror=r=>{console.error("âš ï¸ Error WebSocket:",r)},n.set(o,t),t}function b(o){const e=n.get(o);if(!e){console.warn(`No existe conexiÃ³n WS para "${o}".`);return}if(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING){console.log(`El WebSocket "${o}" ya estÃ¡ cerrado.`),n.delete(o);return}console.log(`ğŸšª Cerrando conexiÃ³n WS para "${o}"...`),e.close(1e3,"Cierre manual"),n.delete(o)}export{b as c,k as s};
