# Base de datos PostgreSQL
database:
  postgres:
    url: "postgres://danich:danich155@127.0.0.1:5432/greenex?sslmode=disable"
    min_conns: 1
    max_conns: 10
    connect_timeout: "10s"
    healthcheck_interval: "30s"

  sqlserver:
    host: "192.168.0.9"
    port: 1433
    user: "Danich"
    password: "yb*;NC&5r9U2"
    database: "UNITEC_DB"
    encrypt: "disable"
    trust_cert: true
    app_name: "API-Greenex"
    connect_timeout: 15
    max_conns: 10
    min_conns: 5
    max_conn_lifetime: "30m"
    max_conn_idle_time: "5m"
    sku_sync_interval: "10s" # Intervalo de sincronización de SKUs desde vista

# Servidor HTTP
http:
  host: "0.0.0.0"
  port: 8081

# Estadísticas de flujo en tiempo real
statistics:
  flow_calculation_interval: 1s # Cada cuántos segundos se calcula y publica el %
  flow_window_duration: 20s # Ventana de tiempo para el cálculo (últimos X segundos)

# Dispositivos Cognex (múltiples)
# IMPORTANTE:
#   - Siempre escuchan en 0.0.0.0 (todas las interfaces)
#   - Se identifican por puerto único
#   - El campo 'host' es solo informativo (IP de la cámara física)
cognex_devices:
  - id: 1
    name: "Cognex Línea 1"
    host: "127.0.0.1" # IP informativa de la cámara física
    port: 8085 # Puerto ÚNICO donde escuchará (0.0.0.0:8085)
    scan_method: "QR" # Método por defecto: QR o DATAMATRIX
    ubicacion: "Línea Principal"
    interval_ms: 1000 # Para simulador: 5 segundos entre lecturas
    no_read_percent: 5 # Para simulador: 5% de errores

  - id: 2
    name: "Cognex Línea 2"
    host: "192.168.121.101" # IP informativa de la cámara física
    port: 8086 # Puerto ÚNICO donde escuchará (0.0.0.0:8086)
    scan_method: "QR" # Método por defecto: QR o DATAMATRIX
    ubicacion: "Línea Secundaria"
    interval_ms: 100 # Para simulador: 10 lecturas/segundo
    no_read_percent: 1 # Para simulador: 1% de errores
  - id: 3
    name: "Cognex salida 1"
    host: "127.0.0.1" # IP informativa de la cámara física
    port: 8087 # Puerto ÚNICO donde escuchará (0.0.0.0:8087)
    scan_method: "DATAMATRIX" # Método por defecto: QR o DATAMATRIX
    ubicacion: "Salida 1"
    interval_ms: 1000 # Para simulador: 1 segundo entre lecturas
    no_read_percent: 5 # Para simulador: 5% de errores

# Sorters (múltiples)
sorters:
  - id: 1
    name: "Sorter Principal"
    plc_endpoint: "opc.tcp://192.168.121.20:4840" # Mismo endpoint por ahora 192.168.121.16 para produccion
    plc:
      object_id: "ns=4;i=1"
      method_id: "ns=4;i=21"
      input_node_id: "ns=4;i=22"
      output_node_id: "ns=4;i=23"
    salidas:
      - id: 1
        physical_id: 1
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 3
        cognex_id: 3
        plc:
          estado_node_id: "ns=4;i=27"
          bloqueo_node_id: "ns=4;i=28"
      - id: 2
        physical_id: 2
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 3
        plc:
          estado_node_id: "ns=4;i=32"
          bloqueo_node_id: "ns=4;i=33"
      - id: 3
        physical_id: 3
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=37"
          bloqueo_node_id: "ns=4;i=38"
      - id: 4
        physical_id: 4
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=42"
          bloqueo_node_id: "ns=4;i=43"
      - id: 5
        physical_id: 5
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=47"
          bloqueo_node_id: "ns=4;i=48"
      - id: 6
        physical_id: 6
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=52"
          bloqueo_node_id: "ns=4;i=53"
      - id: 7
        physical_id: 7
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        cognex_id: 3
        plc:
          estado_node_id: "ns=4;i=57"
          bloqueo_node_id: "ns=4;i=58"
      - id: 8
        physical_id: 8
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=62"
          bloqueo_node_id: "ns=4;i=63"
      - id: 9
        physical_id: 9
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=67"
          bloqueo_node_id: "ns=4;i=68"
      - id: 10
        physical_id: 10
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=72"
          bloqueo_node_id: "ns=4;i=73"
      - id: 11
        physical_id: 11
        nombre: "Salida automatica"
        tipo: "automatica"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=77"
          bloqueo_node_id: "ns=4;i=78"
      - id: 12
        physical_id: 12
        nombre: "Salida de descarte"
        tipo: "descarte"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=83"
          bloqueo_node_id: ""

  - id: 2
    name: "Sorter manual"
    ubicacion: "Planta A - Línea 2"
    cognex_id: 2
    scan_method: "QR"
    plc_endpoint: "opc.tcp://192.168.121.20:4840" # Mismo endpoint por ahora
    plc:
      object_id: "ns=4;i=1"
      method_id: "ns=4;i=20"
      input_node_id: "ns=4;i=21"
      output_node_id: "ns=4;i=22"
    salidas:
      - id: 13
        physical_id: 1
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 3
        cognex_id: 3
        plc:
          estado_node_id: "ns=4;i=26"
          bloqueo_node_id: "ns=4;i=27"
      - id: 14
        physical_id: 2
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 3
        plc:
          estado_node_id: "ns=4;i=31"
          bloqueo_node_id: "ns=4;i=32"
      - id: 15
        physical_id: 3
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=36"
          bloqueo_node_id: "ns=4;i=37"
      - id: 16
        physical_id: 4
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=41"
          bloqueo_node_id: "ns=4;i=42"
      - id: 17
        physical_id: 5
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=46"
          bloqueo_node_id: "ns=4;i=47"
      - id: 18
        physical_id: 6
        nombre: "Salida manunal"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=51"
          bloqueo_node_id: "ns=4;i=52"
      - id: 19
        physical_id: 7
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        cognex_id: 3
        plc:
          estado_node_id: "ns=4;i=56"
          bloqueo_node_id: "ns=4;i=57"
      - id: 20
        physical_id: 8
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=61"
          bloqueo_node_id: "ns=4;i=62"
      - id: 21
        physical_id: 9
        nombre: "Salida manual"
        tipo: "manual"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=66"
          bloqueo_node_id: "ns=4;i=67"
      - id: 22
        physical_id: 10
        nombre: "Salida descarte"
        tipo: "descarte"
        batch_size: 1
        plc:
          estado_node_id: "ns=4;i=71"
          bloqueo_node_id: ""
